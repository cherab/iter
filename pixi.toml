[workspace]
channels = ["https://prefix.dev/conda-forge"]
platforms = ["osx-arm64", "osx-64", "linux-64"]
preview = ["pixi-build"]

# -------------------------------
# === Packaging Configuration ===
# -------------------------------
[package]
name = "cherab-iter"
version = "0.1.0"

[package.build]
backend = { name = "pixi-build-python", version = "*" }

[package.build.config]
noarch = false
env = { SETUPTOOLS_SCM_PRETEND_VERSION = "0.1.0" }

[workspace.build-variants]
python = ["3.10.*", "3.11.*", "3.12.*", "3.13.*"]

[package.host-dependencies]
hatchling = "*"
hatch-vcs = "*"
hatch-cython = ">=0.6.0rc0"
cython = ">=3.1,<4"
cherab = "1.5.*"

[package.run-dependencies]
cherab-imas = { git = "https://github.com/cherab/imas.git", branch = "development" }
imas-core = "*"
platformdirs = "*"
rich = "*"
plotly = "*"

# ---------------------------------
# === Development Configuration ===
# ---------------------------------
[dependencies]
cherab-iter = { path = "." }
ipython = "*"

# For notebook demos
jupyterlab = "*"
ipywidgets = "*"
xarray = "*"
netcdf4 = ">=1.7.2,<2"
python-kaleido = "*"
pyvista = "*"
trame = "*"
trame-vtk = "*"
trame-vuetify = "*"
trame-pvui = "*"
hvplot = ">=0.11.2,<0.12"
jupyter_bokeh = ">=4.0.5,<5"
panel = ">=1.6.2,<2"

[activation.env]
# UDA environment variables
UDA_PORT = "56565"
UDA_HOST = "uda.iter.org"
UDA_CLIENT_SSL_KEY = "$PIXI_PROJECT_ROOT/.uda/private.key"
UDA_CLIENT_CA_SSL_CERT = "$PIXI_PROJECT_ROOT/.uda/ca-server-certificate.pem"
UDA_CLIENT_SSL_CERT = "$PIXI_PROJECT_ROOT/.uda/certificate.pem"
UDA_CLIENT_SSL_AUTHENTICATE = "1"

[tasks]
ipython = { cmd = "ipython", description = "ðŸ Start an IPython shell" }
lab = { cmd = [
    "jupyter",
    "lab",
    "--notebook-dir",
    "demos",
], description = "ðŸš€ Run JupyterLab" }

# === Tests feature ===
[feature.tests.dependencies]
pytest = "*"
pytest-cov = "*"

[feature.tests.tasks]
test = { cmd = ["pytest", "tests"], description = "ðŸ§ª Run the tests" }

# === Docs feature ===
[feature.docs.dependencies]
ipykernel = "*"
ipywidgets = "*"
nbconvert = "*"
nbsphinx = "*"
numpydoc = "*"
pillow = "*"
pygments = ">2.11.0"
sphinx = ">=8.2.2,<9"
sphinx-copybutton = "*"
pydata-sphinx-theme = "*"
sphinx-design = "*"
pandoc = "*"
sphinx-codeautolink = "*"
python-kaleido = "*"

[feature.docs.pypi-dependencies]
sphinx-github-style = "*"

[feature.docs.tasks]
doc-build = { cmd = [
    "sphinx-build",
    "-b",
    "html",
    "-j",
    "auto",
    "source",
    "build/html",
], cwd = "docs", description = "ðŸ“ Build the docs" }
doc-clean = { cmd = [
    "rm",
    "-rf",
    "build",
    "source/_api",
], cwd = "docs", description = "ðŸ”¥ Clean the docs build & api directory" }
doc-serve = { cmd = [
    "python",
    "-m",
    "http.server",
    "8000",
    "--directory",
    "build/html",
], cwd = "docs", description = "ðŸš€ Start a local server for the docs" }

# === Linting feature ===
[feature.lint.dependencies]
dprint = "*"
lefthook = "*"
ruff = "*"
typos = "*"
mypy = "*"
numpydoc = "*"
actionlint = "*"
shellcheck = "*"
validate-pyproject = "*"
cython-lint = "*"
docformatter = "*"
blacken-docs = "*"
taplo = "*"

[feature.lint.tasks]
lefthook = { cmd = "lefthook", description = "ðŸ”— Run lefthook" }
hooks = { cmd = "lefthook install", description = "ðŸ”— Install pre-commit hooks" }
pre-commit = { cmd = "lefthook run pre-commit", description = "ðŸ”— Run pre-commit checks" }
lint = { cmd = "lefthook run pre-commit --all-files --force", description = "ðŸ§¹ Run all linters" }

# === Python environment features ===
[feature.py310.dependencies]
python = "3.10.*"
[feature.py313.dependencies]
python = "3.13.*"

[environments]
default = { features = ["py313"], solve-group = "py313" }
docs = { features = ["py313", "docs"], solve-group = "py313" }
tests = { features = ["py313", "tests"], solve-group = "py313" }
tests-py310 = ["py310", "tests"]
tests-py313 = { features = [
    "py313",
    "tests",
], solve-group = "py313" } # alias of tests
lint = { features = ["lint"], no-default-feature = true }
